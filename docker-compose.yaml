# This file is used to run multiple Docker containers together
# Each service is a container,
# For now I'm only adding one container for the Postgres database,
# I'll setup the Rust container later.
  
# I'm calling service `db` (short for database) and making sure that the
# container has the same name to make it easy to keep track of.
# I've decided to use Postgres 18.1
# I'm mapping port 5432 on my system, 
# with port 5432 of the Docker container where the Postgres cluster 
# will be setup.
services:
  # Service 1
  rust-rest-api-service:
    container_name: "rust-rest-api-service"
    build: .
    ports:
      # HOST_PORT : CONTAINER_PORT
      - "8000:8000"
    environment:
      DATABASE_URL: "postgres://user:password@postgres-database:5432/rust_rest_api_service"
  
  # Service 2
  postgres-database:
    container_name: "postgres-database"
    image: postgres:18.1
    ports:
      # HOST_PORT : CONTAINER_PORT
      - "5432:5432"
    environment:
      # Environment variable for Postgres
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: rust_rest_api_service
    volumes:
      # This is the way to setup a volume in Postgres 18.1
      - pg_data:/var/lib/postgresql

volumes:
  # This where Postgres stores data inside the container
  # This creates a named volume (aka storage)
  # so that the Postgres data persists when the Docker container is restarted.
  # There is nothing after the `:` because 
  # I want to use the default volume settings.
  pg_data:
